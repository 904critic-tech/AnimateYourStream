<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent 3 - Animation Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success { background: #1a3a1a; border-color: #4caf50; }
        .warning { background: #3a3a1a; border-color: #ff9800; }
        .error { background: #3a1a1a; border-color: #f44336; }
        .info { background: #1a1a3a; border-color: #2196f3; }
        .console {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #45a049; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #2a2a2a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Agent 3 - Animation Debug Test</h1>
        
        <div class="status info">
            <h3>üîß Phase 2: Core Animation Fixes</h3>
            <p>Testing animation extraction and mixer update issues</p>
        </div>

        <div class="test-section">
            <h3>üé≠ Elmo Model Animation Test</h3>
            <button onclick="testElmoModel()">Test Elmo Model Loading</button>
            <button onclick="testAnimationExtraction()">Test Animation Extraction</button>
            <button onclick="testMixerUpdate()">Test Mixer Update</button>
            <div id="elmoResults" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üìä Console Debug Output</h3>
            <button onclick="clearConsole()">Clear Console</button>
            <div id="consoleOutput" class="console"></div>
        </div>

        <div class="test-section">
            <h3>üîç Animation System Status</h3>
            <button onclick="checkAnimationSystem()">Check System Status</button>
            <div id="systemStatus" class="result"></div>
        </div>
    </div>

    <script>
        // Console capture
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        const consoleOutput = document.getElementById('consoleOutput');

        function captureConsole(type, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #888;">[${timestamp}]</span> <span style="color: ${type === 'error' ? '#ff6b6b' : type === 'warn' ? '#ffd93d' : '#6bcf7f'};">${type.toUpperCase()}:</span> ${message}`;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = (...args) => {
            captureConsole('log', ...args);
            originalLog.apply(console, args);
        };
        console.warn = (...args) => {
            captureConsole('warn', ...args);
            originalWarn.apply(console, args);
        };
        console.error = (...args) => {
            captureConsole('error', ...args);
            originalError.apply(console, args);
        };

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        function testElmoModel() {
            console.log('üé¨ Agent 3: Testing Elmo model loading...');
            
            const elmoResults = document.getElementById('elmoResults');
            elmoResults.innerHTML = '<div style="color: #ffd93d;">Testing Elmo model loading...</div>';
            
            // Check if the main application is available
            if (window.sandboxModelViewer) {
                console.log('üé¨ Agent 3: SandboxModelViewer available');
                
                // Try to load the Elmo model
                try {
                    window.sandboxModelViewer.loadModel('/Default_Characters/elmo_rigged.glb', 'elmo_rigged.glb');
                    console.log('üé¨ Agent 3: Elmo model load request sent');
                    elmoResults.innerHTML = '<div style="color: #6bcf7f;">‚úÖ Elmo model load request sent successfully</div>';
                } catch (error) {
                    console.error('üé¨ Agent 3: Failed to load Elmo model:', error);
                    elmoResults.innerHTML = `<div style="color: #ff6b6b;">‚ùå Failed to load Elmo model: ${error.message}</div>`;
                }
            } else {
                console.warn('üé¨ Agent 3: SandboxModelViewer not available');
                elmoResults.innerHTML = '<div style="color: #ff6b6b;">‚ùå SandboxModelViewer not available</div>';
            }
        }

        function testAnimationExtraction() {
            console.log('üé¨ Agent 3: Testing animation extraction...');
            
            const elmoResults = document.getElementById('elmoResults');
            elmoResults.innerHTML = '<div style="color: #ffd93d;">Testing animation extraction...</div>';
            
            // Check if animations were extracted
            if (window.__ANIMATION_CONTROLLER__) {
                const state = window.__ANIMATION_CONTROLLER__.getState();
                console.log('üé¨ Agent 3: Animation controller state:', state);
                
                if (state.currentAnimation) {
                    console.log('üé¨ Agent 3: ‚úÖ Animation found:', state.currentAnimation);
                    elmoResults.innerHTML = `<div style="color: #6bcf7f;">‚úÖ Animation found: ${state.currentAnimation}</div>`;
                } else {
                    console.warn('üé¨ Agent 3: ‚ùå No animation found in controller');
                    elmoResults.innerHTML = '<div style="color: #ff6b6b;">‚ùå No animation found in controller</div>';
                }
            } else {
                console.warn('üé¨ Agent 3: Animation controller not available');
                elmoResults.innerHTML = '<div style="color: #ff6b6b;">‚ùå Animation controller not available</div>';
            }
        }

        function testMixerUpdate() {
            console.log('üé¨ Agent 3: Testing mixer update...');
            
            const elmoResults = document.getElementById('elmoResults');
            elmoResults.innerHTML = '<div style="color: #ffd93d;">Testing mixer update...</div>';
            
            // Check if mixer is being updated
            if (window.__ANIMATION_CONTROLLER__) {
                const state = window.__ANIMATION_CONTROLLER__.getState();
                
                if (state.mixer) {
                    console.log('üé¨ Agent 3: ‚úÖ Mixer exists');
                    elmoResults.innerHTML = '<div style="color: #6bcf7f;">‚úÖ Mixer exists and should be updating</div>';
                } else {
                    console.warn('üé¨ Agent 3: ‚ùå No mixer found');
                    elmoResults.innerHTML = '<div style="color: #ff6b6b;">‚ùå No mixer found</div>';
                }
            } else {
                console.warn('üé¨ Agent 3: Animation controller not available');
                elmoResults.innerHTML = '<div style="color: #ff6b6b;">‚ùå Animation controller not available</div>';
            }
        }

        function checkAnimationSystem() {
            console.log('üé¨ Agent 3: Checking animation system status...');
            
            const systemStatus = document.getElementById('systemStatus');
            systemStatus.innerHTML = '<div style="color: #ffd93d;">Checking system status...</div>';
            
            const status = {
                sandboxModelViewer: !!window.sandboxModelViewer,
                animationController: !!window.__ANIMATION_CONTROLLER__,
                threeJS: !!window.THREE,
                currentModel: null,
                currentAnimation: null,
                mixer: null,
                animations: []
            };
            
            if (window.__ANIMATION_CONTROLLER__) {
                const state = window.__ANIMATION_CONTROLLER__.getState();
                status.currentModel = state.currentModel || 'none';
                status.currentAnimation = state.currentAnimation || 'none';
                status.mixer = !!state.mixer;
                status.animations = state.animations || [];
            }
            
            console.log('üé¨ Agent 3: System status:', status);
            
            let statusHTML = '<div style="color: #6bcf7f;">‚úÖ System Status:</div>';
            statusHTML += `<div>SandboxModelViewer: ${status.sandboxModelViewer ? '‚úÖ' : '‚ùå'}</div>`;
            statusHTML += `<div>AnimationController: ${status.animationController ? '‚úÖ' : '‚ùå'}</div>`;
            statusHTML += `<div>ThreeJS: ${status.threeJS ? '‚úÖ' : '‚ùå'}</div>`;
            statusHTML += `<div>Current Model: ${status.currentModel}</div>`;
            statusHTML += `<div>Current Animation: ${status.currentAnimation}</div>`;
            statusHTML += `<div>Mixer: ${status.mixer ? '‚úÖ' : '‚ùå'}</div>`;
            statusHTML += `<div>Animations: ${status.animations.length}</div>`;
            
            systemStatus.innerHTML = statusHTML;
        }

        // Auto-run initial checks
        window.addEventListener('load', () => {
            console.log('üé¨ Agent 3: Animation debug test loaded');
            console.log('üé¨ Agent 3: Starting system check...');
            
            setTimeout(() => {
                checkAnimationSystem();
            }, 1000);
        });
    </script>
</body>
</html>
